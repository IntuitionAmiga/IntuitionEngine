// debug_ioview.go - I/O register viewer for Machine Monitor

package main

import "fmt"

// IORegisterDesc describes a single I/O register for display.
type IORegisterDesc struct {
	Name   string
	Addr   uint32
	Width  int    // 1, 2, or 4 bytes
	Access string // "RW", "RO", "WO"
}

// IODeviceDesc describes a group of I/O registers for a device.
type IODeviceDesc struct {
	Name      string
	Registers []IORegisterDesc
}

var ioDevices = map[string]*IODeviceDesc{
	"video": {
		Name: "VideoChip",
		Registers: []IORegisterDesc{
			{"CTRL", 0xF0000, 4, "RW"},
			{"MODE", 0xF0004, 4, "RW"},
			{"STATUS", 0xF0008, 4, "RO"},
			{"COPPER_CTRL", 0xF000C, 4, "RW"},
			{"COPPER_PTR", 0xF0010, 4, "RW"},
			{"COPPER_PC", 0xF0014, 4, "RO"},
			{"COPPER_STATUS", 0xF0018, 4, "RO"},
			{"BLT_CTRL", 0xF001C, 4, "RW"},
			{"BLT_OP", 0xF0020, 4, "RW"},
			{"BLT_SRC", 0xF0024, 4, "RW"},
			{"BLT_DST", 0xF0028, 4, "RW"},
			{"BLT_WIDTH", 0xF002C, 4, "RW"},
			{"BLT_HEIGHT", 0xF0030, 4, "RW"},
			{"BLT_SRC_STRIDE", 0xF0034, 4, "RW"},
			{"BLT_DST_STRIDE", 0xF0038, 4, "RW"},
			{"BLT_COLOR", 0xF003C, 4, "RW"},
			{"BLT_MASK", 0xF0040, 4, "RW"},
			{"BLT_STATUS", 0xF0044, 4, "RO"},
			{"RASTER_Y", 0xF0048, 4, "RW"},
			{"RASTER_HEIGHT", 0xF004C, 4, "RW"},
			{"RASTER_COLOR", 0xF0050, 4, "RW"},
			{"RASTER_CTRL", 0xF0054, 4, "RW"},
			{"BLT_MODE7_U0", 0xF0058, 4, "RW"},
			{"BLT_MODE7_V0", 0xF005C, 4, "RW"},
			{"BLT_MODE7_DU_COL", 0xF0060, 4, "RW"},
			{"BLT_MODE7_DV_COL", 0xF0064, 4, "RW"},
			{"BLT_MODE7_DU_ROW", 0xF0068, 4, "RW"},
			{"BLT_MODE7_DV_ROW", 0xF006C, 4, "RW"},
			{"BLT_MODE7_TEX_W", 0xF0070, 4, "RW"},
			{"BLT_MODE7_TEX_H", 0xF0074, 4, "RW"},
		},
	},
	"terminal": {
		Name: "Terminal",
		Registers: []IORegisterDesc{
			{"TERM_OUT", 0xF0700, 4, "RW"},
			{"TERM_STATUS", 0xF0704, 4, "RO"},
			{"TERM_IN", 0xF0708, 4, "RO"},
			{"TERM_LINE_STATUS", 0xF070C, 4, "RO"},
			{"TERM_ECHO", 0xF0710, 4, "RW"},
			{"TERM_CURSOR_X", 0xF0714, 4, "RW"},
			{"TERM_CURSOR_Y", 0xF0718, 4, "RW"},
			{"TERM_FG_COLOR", 0xF071C, 4, "RW"},
			{"TERM_BG_COLOR", 0xF0720, 4, "RW"},
			{"TERM_CTRL", 0xF0724, 4, "RW"},
			{"TERM_KEY_IN", 0xF0728, 4, "RO"},
			{"TERM_KEY_STATUS", 0xF072C, 4, "RO"},
			{"TERM_SENTINEL", 0xF07F0, 4, "WO"},
		},
	},
	"audio": {
		Name: "AudioChip",
		Registers: []IORegisterDesc{
			{"CTRL", 0xF0800, 4, "RW"},
			{"ENV_SHAPE", 0xF0804, 4, "RW"},
			{"FILTER_CUTOFF", 0xF0820, 4, "RW"},
			{"FILTER_RESONANCE", 0xF0824, 4, "RW"},
			{"FILTER_TYPE", 0xF0828, 4, "RW"},
			{"FILTER_MOD_SOURCE", 0xF082C, 4, "RW"},
			{"FILTER_MOD_AMOUNT", 0xF0830, 4, "RW"},
			// Square channel
			{"SQUARE_FREQ", 0xF0900, 4, "RW"},
			{"SQUARE_VOL", 0xF0904, 4, "RW"},
			{"SQUARE_CTRL", 0xF0908, 4, "RW"},
			{"SQUARE_DUTY", 0xF090C, 4, "RW"},
			{"SQUARE_SWEEP", 0xF0910, 4, "RW"},
			{"SQUARE_PWM_CTRL", 0xF0922, 4, "RW"},
			{"SQUARE_ATK", 0xF0930, 4, "RW"},
			{"SQUARE_DEC", 0xF0934, 4, "RW"},
			{"SQUARE_SUS", 0xF0938, 4, "RW"},
			{"SQUARE_REL", 0xF093C, 4, "RW"},
			// Triangle channel
			{"TRI_SWEEP", 0xF0914, 4, "RW"},
			{"TRI_FREQ", 0xF0940, 4, "RW"},
			{"TRI_VOL", 0xF0944, 4, "RW"},
			{"TRI_CTRL", 0xF0948, 4, "RW"},
			{"TRI_ATK", 0xF0960, 4, "RW"},
			{"TRI_DEC", 0xF0964, 4, "RW"},
			{"TRI_SUS", 0xF0968, 4, "RW"},
			{"TRI_REL", 0xF096C, 4, "RW"},
			// Sine channel
			{"SINE_SWEEP", 0xF0918, 4, "RW"},
			{"SINE_FREQ", 0xF0980, 4, "RW"},
			{"SINE_VOL", 0xF0984, 4, "RW"},
			{"SINE_CTRL", 0xF0988, 4, "RW"},
			{"SINE_ATK", 0xF0990, 4, "RW"},
			{"SINE_DEC", 0xF0994, 4, "RW"},
			{"SINE_SUS", 0xF0998, 4, "RW"},
			{"SINE_REL", 0xF099C, 4, "RW"},
			// Noise channel
			{"NOISE_FREQ", 0xF09C0, 4, "RW"},
			{"NOISE_VOL", 0xF09C4, 4, "RW"},
			{"NOISE_CTRL", 0xF09C8, 4, "RW"},
			{"NOISE_ATK", 0xF09D0, 4, "RW"},
			{"NOISE_DEC", 0xF09D4, 4, "RW"},
			{"NOISE_SUS", 0xF09D8, 4, "RW"},
			{"NOISE_REL", 0xF09DC, 4, "RW"},
			{"NOISE_MODE", 0xF09E0, 4, "RW"},
			// Sync/ring mod
			{"SYNC_SOURCE_CH0", 0xF0A00, 4, "RW"},
			{"SYNC_SOURCE_CH1", 0xF0A04, 4, "RW"},
			{"SYNC_SOURCE_CH2", 0xF0A08, 4, "RW"},
			{"SYNC_SOURCE_CH3", 0xF0A0C, 4, "RW"},
			{"RING_MOD_SRC_CH0", 0xF0A10, 4, "RW"},
			{"RING_MOD_SRC_CH1", 0xF0A14, 4, "RW"},
			{"RING_MOD_SRC_CH2", 0xF0A18, 4, "RW"},
			{"RING_MOD_SRC_CH3", 0xF0A1C, 4, "RW"},
			// Sawtooth channel
			{"SAW_FREQ", 0xF0A20, 4, "RW"},
			{"SAW_VOL", 0xF0A24, 4, "RW"},
			{"SAW_CTRL", 0xF0A28, 4, "RW"},
			{"SAW_SWEEP", 0xF0A2C, 4, "RW"},
			{"SAW_ATK", 0xF0A30, 4, "RW"},
			{"SAW_DEC", 0xF0A34, 4, "RW"},
			{"SAW_SUS", 0xF0A38, 4, "RW"},
			{"SAW_REL", 0xF0A3C, 4, "RW"},
			// Effects
			{"OVERDRIVE_CTRL", 0xF0A40, 4, "RW"},
			{"REVERB_MIX", 0xF0A50, 4, "RW"},
			{"REVERB_DECAY", 0xF0A54, 4, "RW"},
			// Saw sync/ring mod
			{"SYNC_SOURCE_CH4", 0xF0A60, 4, "RW"},
			{"RING_MOD_SRC_CH4", 0xF0A64, 4, "RW"},
			// Flex channel 0
			{"FLEX_CH0_FREQ", 0xF0A80, 4, "RW"},
			{"FLEX_CH0_VOL", 0xF0A84, 4, "RW"},
			{"FLEX_CH0_CTRL", 0xF0A88, 4, "RW"},
			{"FLEX_CH0_DUTY", 0xF0A8C, 4, "RW"},
			{"FLEX_CH0_SWEEP", 0xF0A90, 4, "RW"},
			{"FLEX_CH0_ATK", 0xF0A94, 4, "RW"},
			{"FLEX_CH0_DEC", 0xF0A98, 4, "RW"},
			{"FLEX_CH0_SUS", 0xF0A9C, 4, "RW"},
			{"FLEX_CH0_REL", 0xF0AA0, 4, "RW"},
			{"FLEX_CH0_WAVE", 0xF0AA4, 4, "RW"},
			{"FLEX_CH0_PWM", 0xF0AA8, 4, "RW"},
			{"FLEX_CH0_NOISEMODE", 0xF0AAC, 4, "RW"},
			{"FLEX_CH0_PHASE", 0xF0AB0, 4, "RW"},
			{"FLEX_CH0_RINGMOD", 0xF0AB4, 4, "RW"},
			{"FLEX_CH0_SYNC", 0xF0AB8, 4, "RW"},
			// Flex channel 1
			{"FLEX_CH1_FREQ", 0xF0AC0, 4, "RW"},
			{"FLEX_CH1_VOL", 0xF0AC4, 4, "RW"},
			{"FLEX_CH1_CTRL", 0xF0AC8, 4, "RW"},
			{"FLEX_CH1_DUTY", 0xF0ACC, 4, "RW"},
			{"FLEX_CH1_SWEEP", 0xF0AD0, 4, "RW"},
			{"FLEX_CH1_ATK", 0xF0AD4, 4, "RW"},
			{"FLEX_CH1_DEC", 0xF0AD8, 4, "RW"},
			{"FLEX_CH1_SUS", 0xF0ADC, 4, "RW"},
			{"FLEX_CH1_REL", 0xF0AE0, 4, "RW"},
			{"FLEX_CH1_WAVE", 0xF0AE4, 4, "RW"},
			{"FLEX_CH1_PWM", 0xF0AE8, 4, "RW"},
			{"FLEX_CH1_NOISEMODE", 0xF0AEC, 4, "RW"},
			{"FLEX_CH1_PHASE", 0xF0AF0, 4, "RW"},
			{"FLEX_CH1_RINGMOD", 0xF0AF4, 4, "RW"},
			{"FLEX_CH1_SYNC", 0xF0AF8, 4, "RW"},
			// Flex channel 2
			{"FLEX_CH2_FREQ", 0xF0B00, 4, "RW"},
			{"FLEX_CH2_VOL", 0xF0B04, 4, "RW"},
			{"FLEX_CH2_CTRL", 0xF0B08, 4, "RW"},
			{"FLEX_CH2_DUTY", 0xF0B0C, 4, "RW"},
			{"FLEX_CH2_SWEEP", 0xF0B10, 4, "RW"},
			{"FLEX_CH2_ATK", 0xF0B14, 4, "RW"},
			{"FLEX_CH2_DEC", 0xF0B18, 4, "RW"},
			{"FLEX_CH2_SUS", 0xF0B1C, 4, "RW"},
			{"FLEX_CH2_REL", 0xF0B20, 4, "RW"},
			{"FLEX_CH2_WAVE", 0xF0B24, 4, "RW"},
			{"FLEX_CH2_PWM", 0xF0B28, 4, "RW"},
			{"FLEX_CH2_NOISEMODE", 0xF0B2C, 4, "RW"},
			{"FLEX_CH2_PHASE", 0xF0B30, 4, "RW"},
			{"FLEX_CH2_RINGMOD", 0xF0B34, 4, "RW"},
			{"FLEX_CH2_SYNC", 0xF0B38, 4, "RW"},
			// Flex channel 3
			{"FLEX_CH3_FREQ", 0xF0B40, 4, "RW"},
			{"FLEX_CH3_VOL", 0xF0B44, 4, "RW"},
			{"FLEX_CH3_CTRL", 0xF0B48, 4, "RW"},
			{"FLEX_CH3_DUTY", 0xF0B4C, 4, "RW"},
			{"FLEX_CH3_SWEEP", 0xF0B50, 4, "RW"},
			{"FLEX_CH3_ATK", 0xF0B54, 4, "RW"},
			{"FLEX_CH3_DEC", 0xF0B58, 4, "RW"},
			{"FLEX_CH3_SUS", 0xF0B5C, 4, "RW"},
			{"FLEX_CH3_REL", 0xF0B60, 4, "RW"},
			{"FLEX_CH3_WAVE", 0xF0B64, 4, "RW"},
			{"FLEX_CH3_PWM", 0xF0B68, 4, "RW"},
			{"FLEX_CH3_NOISEMODE", 0xF0B6C, 4, "RW"},
			{"FLEX_CH3_PHASE", 0xF0B70, 4, "RW"},
			{"FLEX_CH3_RINGMOD", 0xF0B74, 4, "RW"},
			{"FLEX_CH3_SYNC", 0xF0B78, 4, "RW"},
		},
	},
	"ahx": {
		Name: "AHX",
		Registers: []IORegisterDesc{
			{"PLUS_CTRL", 0xF0B80, 1, "RW"},
			{"PLAY_PTR", 0xF0B84, 4, "RW"},
			{"PLAY_LEN", 0xF0B88, 4, "RW"},
			{"PLAY_CTRL", 0xF0B8C, 4, "RW"},
			{"PLAY_STATUS", 0xF0B90, 4, "RO"},
			{"SUBSONG", 0xF0B91, 1, "RW"},
		},
	},
	"psg": {
		Name: "PSG",
		Registers: []IORegisterDesc{
			{"REG0_FREQ_A_LO", 0xF0C00, 1, "RW"},
			{"REG1_FREQ_A_HI", 0xF0C01, 1, "RW"},
			{"REG2_FREQ_B_LO", 0xF0C02, 1, "RW"},
			{"REG3_FREQ_B_HI", 0xF0C03, 1, "RW"},
			{"REG4_FREQ_C_LO", 0xF0C04, 1, "RW"},
			{"REG5_FREQ_C_HI", 0xF0C05, 1, "RW"},
			{"REG6_NOISE_PER", 0xF0C06, 1, "RW"},
			{"REG7_MIXER", 0xF0C07, 1, "RW"},
			{"REG8_AMP_A", 0xF0C08, 1, "RW"},
			{"REG9_AMP_B", 0xF0C09, 1, "RW"},
			{"REG10_AMP_C", 0xF0C0A, 1, "RW"},
			{"REG11_ENV_LO", 0xF0C0B, 1, "RW"},
			{"REG12_ENV_HI", 0xF0C0C, 1, "RW"},
			{"REG13_ENV_SHAPE", 0xF0C0D, 1, "RW"},
			{"PLUS_CTRL", 0xF0C0E, 1, "RW"},
			{"PLAY_PTR", 0xF0C10, 4, "RW"},
			{"PLAY_LEN", 0xF0C14, 4, "RW"},
			{"PLAY_CTRL", 0xF0C18, 4, "RW"},
			{"PLAY_STATUS", 0xF0C1C, 4, "RO"},
		},
	},
	"pokey": {
		Name: "POKEY",
		Registers: []IORegisterDesc{
			{"AUDF1", 0xF0D00, 1, "RW"},
			{"AUDC1", 0xF0D01, 1, "RW"},
			{"AUDF2", 0xF0D02, 1, "RW"},
			{"AUDC2", 0xF0D03, 1, "RW"},
			{"AUDF3", 0xF0D04, 1, "RW"},
			{"AUDC3", 0xF0D05, 1, "RW"},
			{"AUDF4", 0xF0D06, 1, "RW"},
			{"AUDC4", 0xF0D07, 1, "RW"},
			{"AUDCTL", 0xF0D08, 1, "RW"},
			{"PLUS_CTRL", 0xF0D09, 1, "RW"},
			{"PLAY_PTR", 0xF0D10, 4, "RW"},
			{"PLAY_LEN", 0xF0D14, 4, "RW"},
			{"PLAY_CTRL", 0xF0D18, 4, "RW"},
			{"PLAY_STATUS", 0xF0D1C, 4, "RO"},
			{"SAP_SUBSONG", 0xF0D1D, 1, "RW"},
		},
	},
	"sid": {
		Name: "SID",
		Registers: []IORegisterDesc{
			{"V1_FREQ_LO", 0xF0E00, 1, "WO"},
			{"V1_FREQ_HI", 0xF0E01, 1, "WO"},
			{"V1_PW_LO", 0xF0E02, 1, "WO"},
			{"V1_PW_HI", 0xF0E03, 1, "WO"},
			{"V1_CTRL", 0xF0E04, 1, "WO"},
			{"V1_AD", 0xF0E05, 1, "WO"},
			{"V1_SR", 0xF0E06, 1, "WO"},
			{"V2_FREQ_LO", 0xF0E07, 1, "WO"},
			{"V2_FREQ_HI", 0xF0E08, 1, "WO"},
			{"V2_PW_LO", 0xF0E09, 1, "WO"},
			{"V2_PW_HI", 0xF0E0A, 1, "WO"},
			{"V2_CTRL", 0xF0E0B, 1, "WO"},
			{"V2_AD", 0xF0E0C, 1, "WO"},
			{"V2_SR", 0xF0E0D, 1, "WO"},
			{"V3_FREQ_LO", 0xF0E0E, 1, "WO"},
			{"V3_FREQ_HI", 0xF0E0F, 1, "WO"},
			{"V3_PW_LO", 0xF0E10, 1, "WO"},
			{"V3_PW_HI", 0xF0E11, 1, "WO"},
			{"V3_CTRL", 0xF0E12, 1, "WO"},
			{"V3_AD", 0xF0E13, 1, "WO"},
			{"V3_SR", 0xF0E14, 1, "WO"},
			{"FC_LO", 0xF0E15, 1, "WO"},
			{"FC_HI", 0xF0E16, 1, "WO"},
			{"RES_FILT", 0xF0E17, 1, "WO"},
			{"MODE_VOL", 0xF0E18, 1, "WO"},
			{"PLUS_CTRL", 0xF0E19, 1, "RW"},
			{"POT_Y", 0xF0E1A, 1, "RO"},
			{"OSC3", 0xF0E1B, 1, "RO"},
			{"ENV3", 0xF0E1C, 1, "RO"},
			{"PLAY_PTR", 0xF0E20, 4, "RW"},
			{"PLAY_LEN", 0xF0E24, 4, "RW"},
			{"PLAY_CTRL", 0xF0E28, 4, "RW"},
			{"PLAY_STATUS", 0xF0E2C, 4, "RO"},
			{"SUBSONG", 0xF0E2D, 1, "RW"},
		},
	},
	"sid2": {
		Name: "SID2",
		Registers: []IORegisterDesc{
			{"V1_FREQ_LO", 0xF0E30, 1, "WO"},
			{"V1_FREQ_HI", 0xF0E31, 1, "WO"},
			{"V1_PW_LO", 0xF0E32, 1, "WO"},
			{"V1_PW_HI", 0xF0E33, 1, "WO"},
			{"V1_CTRL", 0xF0E34, 1, "WO"},
			{"V1_AD", 0xF0E35, 1, "WO"},
			{"V1_SR", 0xF0E36, 1, "WO"},
			{"V2_FREQ_LO", 0xF0E37, 1, "WO"},
			{"V2_FREQ_HI", 0xF0E38, 1, "WO"},
			{"V2_PW_LO", 0xF0E39, 1, "WO"},
			{"V2_PW_HI", 0xF0E3A, 1, "WO"},
			{"V2_CTRL", 0xF0E3B, 1, "WO"},
			{"V2_AD", 0xF0E3C, 1, "WO"},
			{"V2_SR", 0xF0E3D, 1, "WO"},
			{"V3_FREQ_LO", 0xF0E3E, 1, "WO"},
			{"V3_FREQ_HI", 0xF0E3F, 1, "WO"},
			{"V3_PW_LO", 0xF0E40, 1, "WO"},
			{"V3_PW_HI", 0xF0E41, 1, "WO"},
			{"V3_CTRL", 0xF0E42, 1, "WO"},
			{"V3_AD", 0xF0E43, 1, "WO"},
			{"V3_SR", 0xF0E44, 1, "WO"},
			{"FC_LO", 0xF0E45, 1, "WO"},
			{"FC_HI", 0xF0E46, 1, "WO"},
			{"RES_FILT", 0xF0E47, 1, "WO"},
			{"MODE_VOL", 0xF0E48, 1, "WO"},
			{"PLUS_CTRL", 0xF0E49, 1, "RW"},
			{"POT_Y", 0xF0E4A, 1, "RO"},
			{"OSC3", 0xF0E4B, 1, "RO"},
			{"ENV3", 0xF0E4C, 1, "RO"},
		},
	},
	"sid3": {
		Name: "SID3",
		Registers: []IORegisterDesc{
			{"V1_FREQ_LO", 0xF0E50, 1, "WO"},
			{"V1_FREQ_HI", 0xF0E51, 1, "WO"},
			{"V1_PW_LO", 0xF0E52, 1, "WO"},
			{"V1_PW_HI", 0xF0E53, 1, "WO"},
			{"V1_CTRL", 0xF0E54, 1, "WO"},
			{"V1_AD", 0xF0E55, 1, "WO"},
			{"V1_SR", 0xF0E56, 1, "WO"},
			{"V2_FREQ_LO", 0xF0E57, 1, "WO"},
			{"V2_FREQ_HI", 0xF0E58, 1, "WO"},
			{"V2_PW_LO", 0xF0E59, 1, "WO"},
			{"V2_PW_HI", 0xF0E5A, 1, "WO"},
			{"V2_CTRL", 0xF0E5B, 1, "WO"},
			{"V2_AD", 0xF0E5C, 1, "WO"},
			{"V2_SR", 0xF0E5D, 1, "WO"},
			{"V3_FREQ_LO", 0xF0E5E, 1, "WO"},
			{"V3_FREQ_HI", 0xF0E5F, 1, "WO"},
			{"V3_PW_LO", 0xF0E60, 1, "WO"},
			{"V3_PW_HI", 0xF0E61, 1, "WO"},
			{"V3_CTRL", 0xF0E62, 1, "WO"},
			{"V3_AD", 0xF0E63, 1, "WO"},
			{"V3_SR", 0xF0E64, 1, "WO"},
			{"FC_LO", 0xF0E65, 1, "WO"},
			{"FC_HI", 0xF0E66, 1, "WO"},
			{"RES_FILT", 0xF0E67, 1, "WO"},
			{"MODE_VOL", 0xF0E68, 1, "WO"},
			{"PLUS_CTRL", 0xF0E69, 1, "RW"},
			{"POT_Y", 0xF0E6A, 1, "RO"},
			{"OSC3", 0xF0E6B, 1, "RO"},
			{"ENV3", 0xF0E6C, 1, "RO"},
		},
	},
	"ted": {
		Name: "TED",
		Registers: []IORegisterDesc{
			{"FREQ1_LO", 0xF0F00, 1, "RW"},
			{"FREQ2_LO", 0xF0F01, 1, "RW"},
			{"FREQ2_HI", 0xF0F02, 1, "RW"},
			{"SND_CTRL", 0xF0F03, 1, "RW"},
			{"FREQ1_HI", 0xF0F04, 1, "RW"},
			{"PLUS_CTRL", 0xF0F05, 1, "RW"},
			{"PLAY_PTR", 0xF0F10, 4, "RW"},
			{"PLAY_LEN", 0xF0F14, 4, "RW"},
			{"PLAY_CTRL", 0xF0F18, 4, "RW"},
			{"PLAY_STATUS", 0xF0F1C, 4, "RO"},
			{"V_CTRL1", 0xF0F20, 4, "RW"},
			{"V_CTRL2", 0xF0F24, 4, "RW"},
			{"V_CHAR_BASE", 0xF0F28, 4, "RW"},
			{"V_VIDEO_BASE", 0xF0F2C, 4, "RW"},
			{"V_BG_COLOR0", 0xF0F30, 4, "RW"},
			{"V_BG_COLOR1", 0xF0F34, 4, "RW"},
			{"V_BG_COLOR2", 0xF0F38, 4, "RW"},
			{"V_BG_COLOR3", 0xF0F3C, 4, "RW"},
			{"V_BORDER", 0xF0F40, 4, "RW"},
			{"V_CURSOR_HI", 0xF0F44, 4, "RW"},
			{"V_CURSOR_LO", 0xF0F48, 4, "RW"},
			{"V_CURSOR_CLR", 0xF0F4C, 4, "RW"},
			{"V_RASTER_LO", 0xF0F50, 4, "RO"},
			{"V_RASTER_HI", 0xF0F54, 4, "RO"},
			{"V_ENABLE", 0xF0F58, 4, "RW"},
			{"V_STATUS", 0xF0F5C, 4, "RO"},
		},
	},
	"vga": {
		Name: "VGA",
		Registers: []IORegisterDesc{
			{"MODE", 0xF1000, 4, "RW"},
			{"STATUS", 0xF1004, 4, "RO"},
			{"CTRL", 0xF1008, 4, "RW"},
			{"SEQ_INDEX", 0xF1010, 4, "RW"},
			{"SEQ_DATA", 0xF1014, 4, "RW"},
			{"SEQ_MAPMASK", 0xF1018, 4, "RW"},
			{"CRTC_INDEX", 0xF1020, 4, "RW"},
			{"CRTC_DATA", 0xF1024, 4, "RW"},
			{"CRTC_STARTHI", 0xF1028, 4, "RW"},
			{"CRTC_STARTLO", 0xF102C, 4, "RW"},
			{"GC_INDEX", 0xF1030, 4, "RW"},
			{"GC_DATA", 0xF1034, 4, "RW"},
			{"GC_READMAP", 0xF1038, 4, "RW"},
			{"GC_BITMASK", 0xF103C, 4, "RW"},
			{"ATTR_INDEX", 0xF1040, 4, "RW"},
			{"ATTR_DATA", 0xF1044, 4, "RW"},
			{"DAC_MASK", 0xF1050, 4, "RW"},
			{"DAC_RINDEX", 0xF1054, 4, "RW"},
			{"DAC_WINDEX", 0xF1058, 4, "RW"},
			{"DAC_DATA", 0xF105C, 4, "RW"},
		},
	},
	"ula": {
		Name: "ULA",
		Registers: []IORegisterDesc{
			{"BORDER", 0xF2000, 4, "RW"},
			{"CTRL", 0xF2004, 4, "RW"},
			{"STATUS", 0xF2008, 4, "RO"},
		},
	},
	"antic": {
		Name: "ANTIC",
		Registers: []IORegisterDesc{
			{"DMACTL", 0xF2100, 4, "RW"},
			{"CHACTL", 0xF2104, 4, "RW"},
			{"DLISTL", 0xF2108, 4, "RW"},
			{"DLISTH", 0xF210C, 4, "RW"},
			{"HSCROL", 0xF2110, 4, "RW"},
			{"VSCROL", 0xF2114, 4, "RW"},
			{"PMBASE", 0xF2118, 4, "RW"},
			{"CHBASE", 0xF211C, 4, "RW"},
			{"WSYNC", 0xF2120, 4, "WO"},
			{"VCOUNT", 0xF2124, 4, "RO"},
			{"PENH", 0xF2128, 4, "RO"},
			{"PENV", 0xF212C, 4, "RO"},
			{"NMIEN", 0xF2130, 4, "RW"},
			{"NMIST", 0xF2134, 4, "RO"},
			{"ENABLE", 0xF2138, 4, "RW"},
			{"STATUS", 0xF213C, 4, "RO"},
		},
	},
	"gtia": {
		Name: "GTIA",
		Registers: []IORegisterDesc{
			{"COLPF0", 0xF2140, 4, "RW"},
			{"COLPF1", 0xF2144, 4, "RW"},
			{"COLPF2", 0xF2148, 4, "RW"},
			{"COLPF3", 0xF214C, 4, "RW"},
			{"COLBK", 0xF2150, 4, "RW"},
			{"COLPM0", 0xF2154, 4, "RW"},
			{"COLPM1", 0xF2158, 4, "RW"},
			{"COLPM2", 0xF215C, 4, "RW"},
			{"COLPM3", 0xF2160, 4, "RW"},
			{"PRIOR", 0xF2164, 4, "RW"},
			{"GRACTL", 0xF2168, 4, "RW"},
			{"CONSOL", 0xF216C, 4, "RO"},
			{"HPOSP0", 0xF2170, 4, "RW"},
			{"HPOSP1", 0xF2174, 4, "RW"},
			{"HPOSP2", 0xF2178, 4, "RW"},
			{"HPOSP3", 0xF217C, 4, "RW"},
			{"HPOSM0", 0xF2180, 4, "RW"},
			{"HPOSM1", 0xF2184, 4, "RW"},
			{"HPOSM2", 0xF2188, 4, "RW"},
			{"HPOSM3", 0xF218C, 4, "RW"},
			{"SIZEP0", 0xF2190, 4, "RW"},
			{"SIZEP1", 0xF2194, 4, "RW"},
			{"SIZEP2", 0xF2198, 4, "RW"},
			{"SIZEP3", 0xF219C, 4, "RW"},
			{"SIZEM", 0xF21A0, 4, "RW"},
			{"GRAFP0", 0xF21A4, 4, "RW"},
			{"GRAFP1", 0xF21A8, 4, "RW"},
			{"GRAFP2", 0xF21AC, 4, "RW"},
			{"GRAFP3", 0xF21B0, 4, "RW"},
			{"GRAFM", 0xF21B4, 4, "RW"},
		},
	},
	"fileio": {
		Name: "File I/O",
		Registers: []IORegisterDesc{
			{"FILE_NAME_PTR", 0xF2200, 4, "RW"},
			{"FILE_DATA_PTR", 0xF2204, 4, "RW"},
			{"FILE_DATA_LEN", 0xF2208, 4, "RW"},
			{"FILE_CTRL", 0xF220C, 4, "RW"},
			{"FILE_STATUS", 0xF2210, 4, "RO"},
			{"FILE_RESULT_LEN", 0xF2214, 4, "RO"},
			{"FILE_ERROR_CODE", 0xF2218, 4, "RO"},
		},
	},
	"media": {
		Name: "Media Loader",
		Registers: []IORegisterDesc{
			{"MEDIA_NAME_PTR", 0xF2300, 4, "RW"},
			{"MEDIA_SUBSONG", 0xF2304, 4, "RW"},
			{"MEDIA_CTRL", 0xF2308, 4, "RW"},
			{"MEDIA_STATUS", 0xF230C, 4, "RO"},
			{"MEDIA_TYPE", 0xF2310, 4, "RW"},
			{"MEDIA_ERROR", 0xF2314, 4, "RO"},
		},
	},
	"exec": {
		Name: "Program Executor",
		Registers: []IORegisterDesc{
			{"EXEC_NAME_PTR", 0xF2320, 4, "RW"},
			{"EXEC_CTRL", 0xF2324, 4, "RW"},
			{"EXEC_STATUS", 0xF2328, 4, "RO"},
			{"EXEC_TYPE", 0xF232C, 4, "RW"},
			{"EXEC_ERROR", 0xF2330, 4, "RO"},
			{"EXEC_SESSION", 0xF2334, 4, "RO"},
		},
	},
	"coproc": {
		Name: "Coprocessor",
		Registers: []IORegisterDesc{
			{"COPROC_CMD", 0xF2340, 4, "WO"},
			{"COPROC_CPU_TYPE", 0xF2344, 4, "RW"},
			{"COPROC_CMD_STATUS", 0xF2348, 4, "RO"},
			{"COPROC_CMD_ERROR", 0xF234C, 4, "RO"},
			{"COPROC_TICKET", 0xF2350, 4, "RW"},
			{"COPROC_TICKET_STS", 0xF2354, 4, "RO"},
			{"COPROC_OP", 0xF2358, 4, "RW"},
			{"COPROC_REQ_PTR", 0xF235C, 4, "RW"},
			{"COPROC_REQ_LEN", 0xF2360, 4, "RW"},
			{"COPROC_RESP_PTR", 0xF2364, 4, "RW"},
			{"COPROC_RESP_CAP", 0xF2368, 4, "RW"},
			{"COPROC_TIMEOUT", 0xF236C, 4, "RW"},
			{"COPROC_NAME_PTR", 0xF2370, 4, "RW"},
			{"COPROC_WORKER_ST", 0xF2374, 4, "RO"},
		},
	},
	"voodoo": {
		Name: "Voodoo",
		Registers: []IORegisterDesc{
			{"STATUS", 0xF4000, 4, "RO"},
			{"ENABLE", 0xF4004, 4, "WO"},
			{"VERTEX_AX", 0xF4008, 4, "RW"},
			{"VERTEX_AY", 0xF400C, 4, "RW"},
			{"VERTEX_BX", 0xF4010, 4, "RW"},
			{"VERTEX_BY", 0xF4014, 4, "RW"},
			{"VERTEX_CX", 0xF4018, 4, "RW"},
			{"VERTEX_CY", 0xF401C, 4, "RW"},
			{"START_R", 0xF4020, 4, "RW"},
			{"START_G", 0xF4024, 4, "RW"},
			{"START_B", 0xF4028, 4, "RW"},
			{"START_Z", 0xF402C, 4, "RW"},
			{"START_A", 0xF4030, 4, "RW"},
			{"START_S", 0xF4034, 4, "RW"},
			{"START_T", 0xF4038, 4, "RW"},
			{"START_W", 0xF403C, 4, "RW"},
			// Delta registers (gradients)
			{"DRDX", 0xF4040, 4, "RW"},
			{"DGDX", 0xF4044, 4, "RW"},
			{"DBDX", 0xF4048, 4, "RW"},
			{"DZDX", 0xF404C, 4, "RW"},
			{"DADX", 0xF4050, 4, "RW"},
			{"DSDX", 0xF4054, 4, "RW"},
			{"DTDX", 0xF4058, 4, "RW"},
			{"DWDX", 0xF405C, 4, "RW"},
			{"DRDY", 0xF4060, 4, "RW"},
			{"DGDY", 0xF4064, 4, "RW"},
			{"DBDY", 0xF4068, 4, "RW"},
			{"DZDY", 0xF406C, 4, "RW"},
			{"DADY", 0xF4070, 4, "RW"},
			{"DSDY", 0xF4074, 4, "RW"},
			{"DTDY", 0xF4078, 4, "RW"},
			{"DWDY", 0xF407C, 4, "RW"},
			// Commands
			{"TRIANGLE_CMD", 0xF4080, 4, "WO"},
			{"FTRIANGLE_CMD", 0xF4084, 4, "WO"},
			{"COLOR_SELECT", 0xF4088, 4, "RW"},
			// Configuration
			{"FBZCOLOR_PATH", 0xF4104, 4, "RW"},
			{"FOG_MODE", 0xF4108, 4, "RW"},
			{"ALPHA_MODE", 0xF410C, 4, "RW"},
			{"FBZ_MODE", 0xF4110, 4, "RW"},
			{"LFB_MODE", 0xF4114, 4, "RW"},
			{"CLIP_LEFT_RIGHT", 0xF4118, 4, "RW"},
			{"CLIP_LOW_Y_HIGH", 0xF411C, 4, "RW"},
			{"NOP_CMD", 0xF4120, 4, "WO"},
			{"FAST_FILL_CMD", 0xF4124, 4, "WO"},
			{"SWAP_BUFFER", 0xF4128, 4, "WO"},
			// Fog table (64 entries, showing base only)
			{"FOG_TABLE_BASE", 0xF4140, 4, "RW"},
			// Colors
			{"FOG_COLOR", 0xF41C4, 4, "RW"},
			{"ZA_COLOR", 0xF41C8, 4, "RW"},
			{"CHROMA_KEY", 0xF41CC, 4, "RW"},
			{"CHROMA_RANGE", 0xF41D0, 4, "RW"},
			{"STIPPLE", 0xF41D4, 4, "RW"},
			{"COLOR0", 0xF41D8, 4, "RW"},
			{"COLOR1", 0xF41DC, 4, "RW"},
			// FBI init
			{"FBI_INIT0", 0xF4200, 4, "RW"},
			{"FBI_INIT1", 0xF4204, 4, "RW"},
			{"FBI_INIT2", 0xF4208, 4, "RW"},
			{"FBI_INIT3", 0xF420C, 4, "RW"},
			{"FBI_INIT4", 0xF4210, 4, "RW"},
			// Video timing
			{"VIDEO_DIM", 0xF4214, 4, "RW"},
			{"BACK_PORCH", 0xF4218, 4, "RW"},
			{"VIDEO_DIM_V", 0xF421C, 4, "RW"},
			{"H_SYNC", 0xF4220, 4, "RW"},
			{"V_SYNC", 0xF4224, 4, "RW"},
			{"DAC_DATA", 0xF422C, 4, "RW"},
			// Texture
			{"TEX_MODE", 0xF4300, 4, "RW"},
			{"TLOD", 0xF4304, 4, "RW"},
			{"TDETAIL", 0xF4308, 4, "RW"},
			{"TEX_BASE0", 0xF430C, 4, "RW"},
			{"TEX_BASE1", 0xF4310, 4, "RW"},
			{"TEX_BASE2", 0xF4314, 4, "RW"},
			{"TEX_BASE3", 0xF4318, 4, "RW"},
			{"TEX_BASE4", 0xF431C, 4, "RW"},
			{"TEX_BASE5", 0xF4320, 4, "RW"},
			{"TEX_BASE6", 0xF4324, 4, "RW"},
			{"TEX_BASE7", 0xF4328, 4, "RW"},
			{"TEX_BASE8", 0xF432C, 4, "RW"},
			{"TEX_WIDTH", 0xF4330, 4, "RW"},
			{"TEX_HEIGHT", 0xF4334, 4, "RW"},
			{"TEX_UPLOAD", 0xF4338, 4, "RW"},
		},
	},
}

// formatIOView renders the register view for a device.
func formatIOView(cpu DebuggableCPU, deviceName string) []string {
	dev, ok := ioDevices[deviceName]
	if !ok {
		return []string{fmt.Sprintf("Unknown device: %s", deviceName)}
	}

	var lines []string
	lines = append(lines, fmt.Sprintf("--- %s Registers ---", dev.Name))

	for _, reg := range dev.Registers {
		data := cpu.ReadMemory(uint64(reg.Addr), reg.Width)
		if len(data) < reg.Width {
			lines = append(lines, fmt.Sprintf("  %-20s ($%05X) = ??       [%s]", reg.Name, reg.Addr, reg.Access))
			continue
		}

		var val uint32
		switch reg.Width {
		case 1:
			val = uint32(data[0])
			lines = append(lines, fmt.Sprintf("  %-20s ($%05X) = $%02X       [%d] %s", reg.Name, reg.Addr, val, val, reg.Access))
		case 2:
			val = uint32(data[0]) | uint32(data[1])<<8
			lines = append(lines, fmt.Sprintf("  %-20s ($%05X) = $%04X     [%d] %s", reg.Name, reg.Addr, val, val, reg.Access))
		case 4:
			val = uint32(data[0]) | uint32(data[1])<<8 | uint32(data[2])<<16 | uint32(data[3])<<24
			lines = append(lines, fmt.Sprintf("  %-20s ($%05X) = $%08X [%d] %s", reg.Name, reg.Addr, val, val, reg.Access))
		}
	}

	return lines
}

// listIODevices returns the names of all available IO devices.
func listIODevices() []string {
	return []string{
		"video", "terminal", "audio", "ahx", "psg", "pokey", "sid", "sid2", "sid3", "ted",
		"vga", "ula", "antic", "gtia", "fileio", "media", "exec", "coproc", "voodoo",
	}
}
